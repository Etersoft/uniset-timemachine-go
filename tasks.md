## План: переработка HTTP API под серверное состояние

1. ✅ **Модель состояния на сервере**  
   - Держим status/last_ts/step_id, диапазон, шаг/скорость/окно, pending seek/range в Manager.

2. ✅ **Команды и формат API (v2)**  
   - Реализованы set_range/set_seek/start/pause/resume/stop/step_forward/backward/apply, отдельные тела запросов и конфликты старта.

3. ✅ **Ответы сервера**  
   - `/api/v2/job` и `/api/v1/job` возвращают params + pending (range/seek), step_id/last_ts/updates_sent.

4. ✅ **Клиент (UI)**  
   - UI работает от серверного состояния, управляет pending range/seek и командами, без локальных пересчётов last_ts.

5. ✅ **Логика Manager**  
   - Есть SetRange/SetPendingSeek, start берёт pending, seek/step backward восстанавливают состояние, pending сбрасывается после старта.

6. ✅ **Совместимость**  
   - v1 маршруты сохранены, v2 добавлены; UI использует v2.

7. ✅ **Тестирование**  
   - Покрыты хендлеры/переходы в `internal/api/http_test.go`.  
   - Добавлен UI flow-тест set_range → seek → start → pause → seek → resume → stop (`index.test.js`, автозапуск через `?autotest=1` или кнопка Flow).

8. ✅ **Логи/диагностика**  
   - Хендлеры/команды логируются, UI пишет console.info для обновлений.

## UI/QA

- ✅ Индикатор «Идёт тестирование…» вынесен в статусную панель, мигает зелёным при запуске Smoke/Flow.
- ✅ Кнопки тестов блокируются на время выполнения, по завершении принудительно вызывается stop и восстанавливается позиция таймлайна.
- ✅ Логи UI/console сохраняются в `localStorage` (`tm-ui-test-log`) с пометкой ok/error; кнопка «Скачать лог» показывается только при наличии сохранённого файла.
- ✅ Вкладка «Графики» на Chart.js: локальный embed, выбор датчиков по id/name, легенда-таблица name|value, буфер обновлений из WS, zoom/pan/reset/autozoom Y, подсказки датчиков (datalist).

## План: вкладка «Графики» (Chart.js)

1. ✅ Завершить интеграцию Chart.js: локальные статики, базовый график с time/value осями, zoom/pan/reset/autozoom.
2. ✅ Буфер данных: хранение точек (ts,value) per sensor, лимит по длине, очистка при смене сенсоров.
3. ✅ UI/UX: легенда-таблица с цветоподбором, пустое состояние, переключатель автообновления.
4. ✅ График: tooltip/hover, zoom/pan/reset/autozoom, обновление при прилёте данных, окно по времени.
5. ⚠ Синхронизация: согласовать с состоянием проигрывателя (pause/seek/step), обрезка буфера при смене диапазона/вкладок.
6. ⚠ Тесты/доки: добавить smoke/flow для графиков, обновить README/DOCS с зависимостью Chart.js и описанием кнопок/диапазона.
