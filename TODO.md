## План: единственная управляющая сессия с таймаутом, “забрать управление”

### Сервер / API
- Ввести сессионный ключ (UUID) для управления:
  - GET `/api/v2/session` выдает новый токен, флаги `is_controller`, `controller_age_sec`, `control_timeout`, `controller_session` (опционально). Закрепление происходит на первой успешной управляющей команде.
  - Все управляющие запросы (range/start/pause/stop/seek/step/apply/resume/job/sensors/reset/claim и т.п.) принимают заголовок `X-TM-Session`. Чужой токен → 403 “control locked”.
  - При успешной управляющей команде обновлять `last_seen` для контроллера.
  - Таймаут управления `control_timeout_sec` (конфиг timemachine; 0 — не отдавать). Если now - last_seen > timeout → управление можно перехватить.
- Новый эндпойнт `POST /api/v2/session/claim`: с `X-TM-Session` перехватывает управление, если контроллер просрочен или отсутствует; 403 если timeout=0 или не просрочено.
- Для читающих эндпойнтов (/job GET, /job/range GET, /sensors, /ws/state) — доступ свободный; можно в /ws/state отдавать `controller_session` и `is_controller` (если токен передан в query) для информации.
- Keepalive: либо отдельный ping (e.g. `/api/v2/session?ping=1`), либо обновление `last_seen` на каждую управляющую команду; решить реализацию и сделать.

### Клиент (UI)
- При загрузке страницы: GET `/api/v2/session`, сохранить токен (memory + localStorage), флаг `is_controller`.
- Все управляющие POST/PUT добавляют `X-TM-Session`.
- Поддерживать keepalive, если мы контроллер (таймер или периодическое ping).
- Если пришел 403 на управляющую команду — перейти в read-only: заблокировать управление, показать “Управление занято другой сессией”.
- Добавить кнопку “Забрать управление” (видна в read-only):
  - Запрос `POST /api/v2/session/claim`; при успехе — становимся контроллером, разблокируем UI; при 403 — показать, что управление еще не просрочено/нельзя отдать.
- На вкладке “Управление” отображать предупреждение в read-only, органы управления disabled; таблица/графики остаются для просмотра.
- При перезагрузке страницы восстанавливать токен из localStorage и статус (если 403 → read-only).

### Тесты
- Go:
  - Первая сессия закрепляет управление; вторая получает 403 на управляющие запросы.
  - При control_timeout>0 и просрочке last_seen — claim успешен; после claim команды новой сессии проходят, старой — 403.
  - keepalive обновляет last_seen (не дает просрочиться).
- Playwright:
  - Два клиента: первый управляет, второй видит блокировку (play/stop/др. disabled, предупреждение).
  - Тест claim: искусственно ждём таймаут (или мок), второй жмет “Забрать управление” — после этого он может управлять, первый получает 403.

### Документация
- Обновить DOCS/details/README: описать `/api/v2/session`, `/api/v2/session/claim`, заголовок `X-TM-Session`, таймаут управления и коды ошибок (403 “control locked”), поведение keepalive и кнопку “Забрать управление”.
